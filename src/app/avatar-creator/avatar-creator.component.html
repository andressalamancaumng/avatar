<!-- src/app/avatar-creator/avatar-creator.component.html -->

<!-- Loading Screen -->
<div class="loading-screen" *ngIf="isLoading">
  <div class="loading-content">
    <div class="dna-container">
      <div class="dna-helix">
        <div class="dna-strand"></div>
        <div class="dna-strand"></div>
      </div>
    </div>
    <h1 class="loading-title">Cargando el ADN del campus</h1>
    <div class="loading-bar-container">
      <div class="loading-bar" [style.width.%]="loadingProgress"></div>
    </div>
    <p class="loading-percentage">{{ loadingProgress | number:'1.0-0' }}%</p>
  </div>
</div>

<!-- Main App -->
<div class="avatar-creator" *ngIf="!isLoading">
  <!-- Header Fixed -->
  <div class="header">
    <!-- Commitment Progress Bar -->
    <div class="commitment-section">
      <label class="commitment-label">Barra de Compromiso</label>
      <div class="commitment-message">{{ commitmentMessage }}</div>
      <div class="commitment-bar-container">
        <div class="commitment-bar" [style.width.%]="commitmentProgress">
          <span class="commitment-percentage" *ngIf="commitmentProgress > 10">
            {{ commitmentProgress | number:'1.0-0' }}%
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Avatar Screen -->
  <div class="content" *ngIf="!showCustomizationScreen">
    <!-- Avatar Preview Centered -->
    <div class="avatar-preview">
      <div class="avatar-container">
        <svg viewBox="0 0 200 300" class="avatar-svg">
          <!-- Role-specific background elements -->

          <!-- Estudiante: Pasillo de Universidad -->
          <g *ngIf="avatar.role === 'estudiante'">
            <!-- Piso del pasillo -->
            <rect x="0" y="250" width="200" height="50" fill="#D4D4D4" />
            <!-- Baldosas del piso -->
            <line x1="0" y1="265" x2="200" y2="265" stroke="#B8B8B8" stroke-width="1" />
            <line x1="0" y1="280" x2="200" y2="280" stroke="#B8B8B8" stroke-width="1" />
            <line x1="50" y1="250" x2="50" y2="300" stroke="#B8B8B8" stroke-width="1" />
            <line x1="100" y1="250" x2="100" y2="300" stroke="#B8B8B8" stroke-width="1" />
            <line x1="150" y1="250" x2="150" y2="300" stroke="#B8B8B8" stroke-width="1" />

            <!-- Pared izquierda con perspectiva -->
            <path d="M 0 0 L 0 250 L 30 240 L 30 20 Z" fill="#E8E4D9" />
            <!-- Pared derecha con perspectiva -->
            <path d="M 200 0 L 200 250 L 170 240 L 170 20 Z" fill="#E8E4D9" />

            <!-- Pared del fondo -->
            <rect x="30" y="0" width="140" height="120" fill="#F5F1E6" />

            <!-- Ventanas en el pasillo (izquierda) -->
            <rect x="5" y="40" width="20" height="30" fill="#B8D8E8" rx="2" />
            <line x1="5" y1="55" x2="25" y2="55" stroke="#7A98A8" stroke-width="1" />
            <line x1="15" y1="40" x2="15" y2="70" stroke="#7A98A8" stroke-width="1" />

            <rect x="5" y="90" width="20" height="30" fill="#B8D8E8" rx="2" />
            <line x1="5" y1="105" x2="25" y2="105" stroke="#7A98A8" stroke-width="1" />
            <line x1="15" y1="90" x2="15" y2="120" stroke="#7A98A8" stroke-width="1" />

            <!-- Puerta en el fondo -->
            <rect x="70" y="30" width="35" height="75" fill="#8B4513" rx="2" />
            <rect x="73" y="33" width="29" height="69" fill="#A0522D" rx="1" />
            <circle cx="98" cy="72" r="2" fill="#DAA520" />

            <!-- Cartelera en pared derecha -->
            <rect x="175" y="60" width="20" height="25" fill="#FFFFFF" stroke="#333" stroke-width="1" />
            <rect x="177" y="63" width="16" height="3" fill="#667eea" />
            <rect x="177" y="68" width="12" height="2" fill="#333" opacity="0.3" />
            <rect x="177" y="72" width="14" height="2" fill="#333" opacity="0.3" />
            <rect x="177" y="76" width="10" height="2" fill="#333" opacity="0.3" />
          </g>

          <!-- Docente: Aula con Tablero -->
          <g *ngIf="avatar.role === 'docente'">
            <!-- Piso del aula -->
            <rect x="0" y="240" width="200" height="60" fill="#C9B896" />
            <!-- L√≠neas del piso -->
            <line x1="0" y1="260" x2="200" y2="260" stroke="#B0A080" stroke-width="1" opacity="0.5" />
            <line x1="0" y1="280" x2="200" y2="280" stroke="#B0A080" stroke-width="1" opacity="0.5" />

            <!-- Paredes laterales -->
            <rect x="0" y="0" width="25" height="240" fill="#F0E6D2" />
            <rect x="175" y="0" width="25" height="240" fill="#F0E6D2" />

            <!-- Pared del fondo -->
            <rect x="25" y="0" width="150" height="120" fill="#FAF5E9" />

            <!-- Ventanas del aula (izquierda) -->
            <rect x="3" y="30" width="19" height="45" fill="#A8D5E8" rx="2" />
            <line x1="3" y1="52" x2="22" y2="52" stroke="#7A98A8" stroke-width="1.5" />
            <line x1="12" y1="30" x2="12" y2="75" stroke="#7A98A8" stroke-width="1.5" />

            <rect x="3" y="100" width="19" height="45" fill="#A8D5E8" rx="2" />
            <line x1="3" y1="122" x2="22" y2="122" stroke="#7A98A8" stroke-width="1.5" />
            <line x1="12" y1="100" x2="12" y2="145" stroke="#7A98A8" stroke-width="1.5" />

            <!-- Ventana derecha -->
            <rect x="178" y="30" width="19" height="45" fill="#A8D5E8" rx="2" />
            <line x1="178" y1="52" x2="197" y2="52" stroke="#7A98A8" stroke-width="1.5" />
            <line x1="187" y1="30" x2="187" y2="75" stroke="#7A98A8" stroke-width="1.5" />

            <!-- Marco del tablero (verde) -->
            <rect x="40" y="20" width="120" height="85" fill="#2d5016" rx="3" />
            <!-- Superficie del tablero (verde pizarra) -->
            <rect x="45" y="25" width="110" height="75" fill="#1a4d2e" rx="2" />

            <!-- Contenido escrito en el tablero -->
            <text x="100" y="45" font-family="Arial" font-size="8" fill="#FFFFFF" text-anchor="middle" font-weight="bold">Yo Te Protejo</text>
            <line x1="55" y1="55" x2="145" y2="55" stroke="#4a7c59" stroke-width="0.5" />
            <line x1="55" y1="65" x2="130" y2="65" stroke="#4a7c59" stroke-width="0.5" />
            <line x1="55" y1="75" x2="140" y2="75" stroke="#4a7c59" stroke-width="0.5" />
            <line x1="55" y1="85" x2="120" y2="85" stroke="#4a7c59" stroke-width="0.5" />

            <!-- Borrador y tizas -->
            <rect x="140" y="107" width="15" height="6" fill="#f4e4c1" rx="1" />
            <rect x="125" y="108" width="3" height="8" fill="#ffffff" />
            <rect x="130" y="108" width="3" height="8" fill="#ffd700" />
            <rect x="135" y="108" width="3" height="8" fill="#ff6b6b" />

            <!-- Sugerencia de pupitres (esquinas) -->
            <rect x="5" y="220" width="30" height="20" fill="#8B7355" rx="2" opacity="0.6" />
            <rect x="165" y="220" width="30" height="20" fill="#8B7355" rx="2" opacity="0.6" />
          </g>

          <!-- Administrativo: Oficina con Escritorio y Ventana -->
          <g *ngIf="avatar.role === 'administrativo'">
            <!-- Piso de oficina -->
            <rect x="0" y="240" width="200" height="60" fill="#8B8680" />
            <!-- Textura del piso -->
            <rect x="0" y="260" width="200" height="2" fill="#6B6660" opacity="0.3" />
            <rect x="0" y="280" width="200" height="2" fill="#6B6660" opacity="0.3" />

            <!-- Paredes -->
            <rect x="0" y="0" width="200" height="120" fill="#E8E4D9" />

            <!-- Ventana grande en el fondo -->
            <rect x="30" y="10" width="70" height="80" fill="#87CEEB" rx="3" />
            <!-- Marco de ventana -->
            <rect x="30" y="10" width="70" height="80" fill="none" stroke="#5A5A5A" stroke-width="3" rx="3" />
            <!-- Divisiones de ventana -->
            <line x1="65" y1="10" x2="65" y2="90" stroke="#5A5A5A" stroke-width="2" />
            <line x1="30" y1="50" x2="100" y2="50" stroke="#5A5A5A" stroke-width="2" />
            <!-- Nubes visibles por la ventana -->
            <ellipse cx="50" cy="30" rx="8" ry="5" fill="#FFFFFF" opacity="0.7" />
            <ellipse cx="55" cy="32" rx="6" ry="4" fill="#FFFFFF" opacity="0.7" />
            <ellipse cx="75" cy="65" rx="9" ry="6" fill="#FFFFFF" opacity="0.7" />
            <ellipse cx="80" cy="67" rx="7" ry="5" fill="#FFFFFF" opacity="0.7" />

            <!-- Estante de archivos en la pared derecha -->
            <rect x="130" y="25" width="60" height="70" fill="#654321" />
            <rect x="132" y="27" width="56" height="20" fill="#7A5230" />
            <rect x="132" y="49" width="56" height="20" fill="#7A5230" />
            <rect x="132" y="71" width="56" height="20" fill="#7A5230" />
            <!-- Carpetas/libros en el estante -->
            <rect x="135" y="30" width="8" height="15" fill="#3498DB" />
            <rect x="145" y="30" width="8" height="15" fill="#E74C3C" />
            <rect x="155" y="30" width="8" height="15" fill="#2ECC71" />
            <rect x="135" y="52" width="8" height="15" fill="#F39C12" />
            <rect x="145" y="52" width="8" height="15" fill="#9B59B6" />
            <rect x="155" y="52" width="8" height="15" fill="#E67E22" />

            <!-- Planta en la esquina -->
            <ellipse cx="15" cy="235" rx="12" ry="8" fill="#8B4513" />
            <ellipse cx="15" cy="233" rx="10" ry="6" fill="#A0522D" />
            <path d="M 15 220 Q 10 225 12 233" fill="#27AE60" />
            <path d="M 15 220 Q 20 225 18 233" fill="#229954" />
            <path d="M 15 218 Q 15 223 15 233" fill="#2ECC71" />

            <!-- Escritorio (superficie m√°s amplia) -->
            <rect x="0" y="110" width="200" height="30" fill="#8B4513" rx="2" />
            <rect x="0" y="110" width="200" height="5" fill="#A0522D" rx="2" />
            <!-- Sombra del escritorio -->
            <rect x="0" y="138" width="200" height="3" fill="#5C4033" opacity="0.3" />

            <!-- Monitor (en la derecha) -->
            <rect x="120" y="65" width="70" height="45" fill="#1a1a1a" rx="3" />
            <!-- Pantalla -->
            <rect x="123" y="68" width="64" height="36" fill="#2980b9" rx="2" />
            <!-- Brillo de pantalla -->
            <rect x="125" y="70" width="25" height="18" fill="#3498db" opacity="0.4" rx="1" />
            <!-- Contenido de pantalla (gr√°fico simple) -->
            <rect x="127" y="75" width="56" height="2" fill="#ecf0f1" opacity="0.6" />
            <rect x="127" y="79" width="40" height="2" fill="#ecf0f1" opacity="0.6" />
            <rect x="127" y="83" width="48" height="2" fill="#ecf0f1" opacity="0.6" />
            <!-- Base del monitor -->
            <rect x="150" y="104" width="10" height="6" fill="#2c3e50" />
            <!-- Pie del monitor -->
            <rect x="140" y="109" width="30" height="2" fill="#34495e" rx="1" />

            <!-- Teclado (en la derecha) -->
            <rect x="110" y="115" width="55" height="15" fill="#2c3e50" rx="2" />
            <rect x="112" y="117" width="51" height="11" fill="#34495e" rx="1" />
            <!-- Teclas -->
            <rect x="114" y="119" width="3" height="3" fill="#95a5a6" rx="0.5" />
            <rect x="118" y="119" width="3" height="3" fill="#95a5a6" rx="0.5" />
            <rect x="122" y="119" width="3" height="3" fill="#95a5a6" rx="0.5" />
            <rect x="126" y="119" width="3" height="3" fill="#95a5a6" rx="0.5" />
            <rect x="130" y="119" width="3" height="3" fill="#95a5a6" rx="0.5" />
            <rect x="114" y="123" width="3" height="3" fill="#95a5a6" rx="0.5" />
            <rect x="118" y="123" width="3" height="3" fill="#95a5a6" rx="0.5" />
            <rect x="122" y="123" width="3" height="3" fill="#95a5a6" rx="0.5" />

            <!-- Mouse (a la derecha del teclado) -->
            <ellipse cx="175" cy="122" rx="5" ry="7" fill="#2c3e50" />
            <ellipse cx="175" cy="121" rx="4" ry="6" fill="#7f8c8d" />
            <line x1="175" y1="118" x2="175" y2="124" stroke="#5a6266" stroke-width="0.5" />

            <!-- Papeles/documentos en la izquierda del escritorio -->
            <rect x="15" y="113" width="25" height="18" fill="#ecf0f1" rx="1" opacity="0.9" />
            <rect x="18" y="115" width="19" height="1" fill="#bdc3c7" />
            <rect x="18" y="117" width="16" height="1" fill="#bdc3c7" />
            <rect x="18" y="119" width="18" height="1" fill="#bdc3c7" />

            <!-- Porta l√°pices a la izquierda -->
            <rect x="45" y="117" width="12" height="14" fill="#34495e" rx="1" />
            <rect x="45" y="117" width="12" height="2" fill="#2c3e50" />
            <!-- L√°pices -->
            <rect x="48" y="113" width="2" height="10" fill="#F1C40F" />
            <rect x="51" y="115" width="2" height="8" fill="#E74C3C" />
            <rect x="54" y="114" width="2" height="9" fill="#3498DB" />

            <!-- L√°mpara de escritorio -->
            <line x1="70" y1="110" x2="70" y2="95" stroke="#2c3e50" stroke-width="2" />
            <path d="M 60 95 L 70 90 L 80 95 Z" fill="#F39C12" />
            <ellipse cx="70" cy="110" rx="6" ry="3" fill="#34495e" />
          </g>

          <!-- Hair (behind everything) -->
          <g *ngIf="avatar.hairStyle && avatar.hairStyle !== 'bald'">
            <!-- Short Hair - Simple cap -->
            <g *ngIf="avatar.hairStyle === 'short'">
              <ellipse cx="100" cy="60" rx="50" ry="40" [attr.fill]="avatar.hairColor || '#3B2414'" />
            </g>

            <!-- Medium Hair - Extends to shoulders -->
            <g *ngIf="avatar.hairStyle === 'medium'">
              <ellipse cx="100" cy="60" rx="52" ry="42" [attr.fill]="avatar.hairColor || '#3B2414'" />
              <path d="M 52 70 L 48 110 L 65 110 L 60 75 Z" [attr.fill]="avatar.hairColor || '#3B2414'" />
              <path d="M 148 70 L 152 110 L 135 110 L 140 75 Z" [attr.fill]="avatar.hairColor || '#3B2414'" />
            </g>

            <!-- Long Hair - Extends down -->
            <g *ngIf="avatar.hairStyle === 'long'">
              <ellipse cx="100" cy="60" rx="54" ry="44" [attr.fill]="avatar.hairColor || '#3B2414'" />
              <path d="M 50 70 L 45 130 L 65 130 L 60 75 Z" [attr.fill]="avatar.hairColor || '#3B2414'" />
              <path d="M 150 70 L 155 130 L 135 130 L 140 75 Z" [attr.fill]="avatar.hairColor || '#3B2414'" />
            </g>

            <!-- Ponytail -->
            <g *ngIf="avatar.hairStyle === 'ponytail'">
              <ellipse cx="100" cy="60" rx="50" ry="40" [attr.fill]="avatar.hairColor || '#3B2414'" />
              <ellipse cx="148" cy="80" rx="12" ry="28" [attr.fill]="avatar.hairColor || '#3B2414'" transform="rotate(15 148 80)"/>
            </g>
          </g>

          <!-- Head -->
          <ellipse cx="100" cy="80" rx="45" ry="50" [attr.fill]="avatar.skinColor || '#F4C4A0'" />

          <!-- Eyes -->
          <circle cx="85" cy="75" r="5" fill="#000000" />
          <circle cx="115" cy="75" r="5" fill="#000000" />

          <!-- Hair Fringe (covers forehead but not eyes) -->
          <g *ngIf="avatar.hairStyle && avatar.hairStyle !== 'bald'">
            <!-- Short Hair Fringe -->
            <ellipse *ngIf="avatar.hairStyle === 'short'"
                     cx="100" cy="45" rx="47" ry="15"
                     [attr.fill]="avatar.hairColor || '#3B2414'" />

            <!-- Medium Hair Fringe -->
            <ellipse *ngIf="avatar.hairStyle === 'medium'"
                     cx="100" cy="45" rx="49" ry="17"
                     [attr.fill]="avatar.hairColor || '#3B2414'" />

            <!-- Long Hair Fringe -->
            <ellipse *ngIf="avatar.hairStyle === 'long'"
                     cx="100" cy="45" rx="51" ry="18"
                     [attr.fill]="avatar.hairColor || '#3B2414'" />

            <!-- Ponytail Fringe -->
            <ellipse *ngIf="avatar.hairStyle === 'ponytail'"
                     cx="100" cy="45" rx="47" ry="15"
                     [attr.fill]="avatar.hairColor || '#3B2414'" />
          </g>

          <!-- Glasses -->
          <g *ngIf="avatar.glasses">
            <rect x="75" y="70" width="20" height="15" fill="none" stroke="#333333" stroke-width="2" rx="3"/>
            <rect x="105" y="70" width="20" height="15" fill="none" stroke="#333333" stroke-width="2" rx="3"/>
            <line x1="95" y1="77" x2="105" y2="77" stroke="#333333" stroke-width="2"/>
            <line x1="75" y1="77" x2="65" y2="77" stroke="#333333" stroke-width="2"/>
            <line x1="125" y1="77" x2="135" y2="77" stroke="#333333" stroke-width="2"/>
          </g>

          <!-- Head Bandana -->
          <g *ngIf="avatar.headBandana && avatar.hairStyle && avatar.hairStyle !== 'bald'">
            <ellipse cx="100" cy="65" rx="52" ry="8" fill="#E74C3C"/>
            <circle cx="145" cy="65" r="5" fill="#C0392B"/>
          </g>
          
          <!-- Nose -->
          <line x1="100" y1="85" x2="100" y2="95" stroke="#000000" stroke-width="2" />
          
          <!-- Mouth -->
          <path d="M 90 105 Q 100 110 110 105" stroke="#000000" stroke-width="2" fill="none" />
          
          <!-- Neck -->
          <rect x="85" y="125" width="30" height="15" [attr.fill]="avatar.skinColor || '#F4C4A0'" />
          
          <!-- Shirt/Body - T-Shirt -->
          <g *ngIf="avatar.shirtType === 'tshirt'">
            <rect x="60" y="140" width="80" height="70" [attr.fill]="avatar.shirtColor || '#4A90E2'" rx="5" />
            <line x1="100" y1="140" x2="100" y2="210" stroke="#000000" stroke-width="1" opacity="0.2" />
            
            <!-- Chest Bandana for T-Shirt -->
            <g *ngIf="avatar.chestBandana">
              <rect x="75" y="155" width="50" height="8" fill="#E74C3C" rx="2"/>
              <polygon points="120,159 125,155 125,163" fill="#C0392B"/>
            </g>
          </g>
          
          <!-- Shirt/Body - Hoodie -->
          <g *ngIf="avatar.shirtType === 'hoodie'">
            <rect x="60" y="140" width="80" height="70" [attr.fill]="avatar.shirtColor || '#4A90E2'" rx="5" />
            <!-- Hood -->
            <path d="M 70 140 Q 100 125 130 140" [attr.fill]="avatar.shirtColor || '#4A90E2'" stroke="#000000" stroke-width="1" opacity="0.3"/>
            <!-- Zipper -->
            <line x1="100" y1="140" x2="100" y2="210" stroke="#666666" stroke-width="3" />
            <circle cx="100" cy="145" r="3" fill="#888888"/>
            <circle cx="100" cy="160" r="3" fill="#888888"/>
            <circle cx="100" cy="175" r="3" fill="#888888"/>
            <circle cx="100" cy="190" r="3" fill="#888888"/>
            <circle cx="100" cy="205" r="3" fill="#888888"/>
            <!-- Pockets -->
            <rect x="65" y="170" width="15" height="20" [attr.fill]="avatar.shirtColor || '#4A90E2'" stroke="#000000" stroke-width="1" opacity="0.3" rx="2"/>
            <rect x="120" y="170" width="15" height="20" [attr.fill]="avatar.shirtColor || '#4A90E2'" stroke="#000000" stroke-width="1" opacity="0.3" rx="2"/>
            
            <!-- Chest Bandana for Hoodie -->
            <g *ngIf="avatar.chestBandana">
              <rect x="75" y="155" width="50" height="8" fill="#E74C3C" rx="2"/>
              <polygon points="120,159 125,155 125,163" fill="#C0392B"/>
            </g>
          </g>
          
          <!-- Arms -->
          <rect x="40" y="145" width="20" height="60" [attr.fill]="avatar.shirtColor || '#4A90E2'" rx="10" />
          <rect x="140" y="145" width="20" height="60" [attr.fill]="avatar.shirtColor || '#4A90E2'" rx="10" />
          <circle cx="50" cy="205" r="8" [attr.fill]="avatar.skinColor || '#F4C4A0'" />
          <circle cx="150" cy="205" r="8" [attr.fill]="avatar.skinColor || '#F4C4A0'" />
          
          <!-- Pants/Shorts/Skirt -->
          <g>
            <!-- Regular Pants -->
            <g *ngIf="avatar.pantsType === 'pants'">
              <rect x="65" y="210" width="30" height="70" [attr.fill]="avatar.pantsColor || '#2C3E50'" />
              <rect x="105" y="210" width="30" height="70" [attr.fill]="avatar.pantsColor || '#2C3E50'" />
              <line x1="80" y1="210" x2="80" y2="280" stroke="#000000" stroke-width="1" opacity="0.2" />
              <line x1="120" y1="210" x2="120" y2="280" stroke="#000000" stroke-width="1" opacity="0.2" />
            </g>
            
            <!-- Shorts -->
            <g *ngIf="avatar.pantsType === 'shorts'">
              <rect x="65" y="210" width="30" height="40" [attr.fill]="avatar.pantsColor || '#2C3E50'" rx="3"/>
              <rect x="105" y="210" width="30" height="40" [attr.fill]="avatar.pantsColor || '#2C3E50'" rx="3"/>
              <line x1="80" y1="210" x2="80" y2="250" stroke="#000000" stroke-width="1" opacity="0.2" />
              <line x1="120" y1="210" x2="120" y2="250" stroke="#000000" stroke-width="1" opacity="0.2" />
              <!-- Legs visible -->
              <rect x="68" y="250" width="24" height="30" [attr.fill]="avatar.skinColor || '#F4C4A0'" />
              <rect x="108" y="250" width="24" height="30" [attr.fill]="avatar.skinColor || '#F4C4A0'" />
            </g>
            
            <!-- Skirt -->
            <g *ngIf="avatar.pantsType === 'skirt'">
              <!-- Single piece skirt -->
              <path d="M 65 210 L 55 265 L 145 265 L 135 210 Z"
                    [attr.fill]="avatar.pantsColor || '#2C3E50'"
                    stroke="#000000"
                    stroke-width="1.5"
                    opacity="0.95"/>
              <!-- Waistband -->
              <rect x="65" y="210" width="70" height="5"
                    [attr.fill]="avatar.pantsColor || '#2C3E50'"
                    opacity="0.8"/>
              <!-- Pleat lines for detail -->
              <line x1="80" y1="215" x2="70" y2="265" stroke="#000000" stroke-width="1" opacity="0.2" />
              <line x1="100" y1="215" x2="100" y2="265" stroke="#000000" stroke-width="1" opacity="0.2" />
              <line x1="120" y1="215" x2="130" y2="265" stroke="#000000" stroke-width="1" opacity="0.2" />
              <!-- Legs visible below skirt -->
              <rect x="62" y="265" width="26" height="15" [attr.fill]="avatar.skinColor || '#F4C4A0'" />
              <rect x="112" y="265" width="26" height="15" [attr.fill]="avatar.skinColor || '#F4C4A0'" />
            </g>
          </g>
          
          <!-- Shoes -->
          <ellipse cx="80" cy="285" rx="18" ry="8" fill="#333333" />
          <ellipse cx="120" cy="285" rx="18" ry="8" fill="#333333" />

          <!-- Estudiante: Morral/Mochila en el suelo -->
          <g *ngIf="avatar.role === 'estudiante'">
            <!-- Cuerpo principal del morral -->
            <path d="M 140 260 L 140 290 L 180 290 L 180 260 Z" fill="#4A90E2" stroke="#2c5aa0" stroke-width="2" />
            <!-- Bolsillo frontal -->
            <path d="M 145 265 L 145 280 L 175 280 L 175 265 Z" fill="#3a7bc8" stroke="#2c5aa0" stroke-width="1" />
            <!-- Cierre del bolsillo -->
            <line x1="150" y1="272" x2="170" y2="272" stroke="#2c5aa0" stroke-width="2" />
            <!-- Correa izquierda -->
            <path d="M 145 260 Q 140 250 140 240" stroke="#2c5aa0" stroke-width="3" fill="none" />
            <!-- Correa derecha -->
            <path d="M 175 260 Q 180 250 180 240" stroke="#2c5aa0" stroke-width="3" fill="none" />
            <!-- Base del morral -->
            <ellipse cx="160" cy="290" rx="20" ry="5" fill="#2c5aa0" opacity="0.7" />
            <!-- Detalles de costuras -->
            <line x1="142" y1="265" x2="142" y2="288" stroke="#2c5aa0" stroke-width="1" opacity="0.5" />
            <line x1="178" y1="265" x2="178" y2="288" stroke="#2c5aa0" stroke-width="1" opacity="0.5" />
          </g>
        </svg>
      </div>

      <!-- Floating Action Buttons -->
      <div class="floating-actions">
        <button (click)="openCustomizationMenu()" class="btn-fab btn-primary-fab">
          ‚ú® Personalizar
        </button>
        <button (click)="resetAvatar()" class="btn-fab btn-secondary-fab">
          üîÑ Reiniciar
        </button>
        <button (click)="saveAvatar()" class="btn-fab btn-save-fab">
          üíæ Guardar
        </button>
      </div>
    </div>
  </div>

  <!-- Customization Menu -->
  <div class="customization-menu-overlay" *ngIf="showCustomizationMenu" (click)="closeCustomizationMenu()"></div>
  <div class="customization-menu" [class.show]="showCustomizationMenu">
    <div class="menu-header">
      <h3>Opciones de Personalizaci√≥n</h3>
      <button (click)="closeCustomizationMenu()" class="btn-close">‚úï</button>
    </div>
    <div class="menu-content">
      <button (click)="openCustomizationScreen('role')" class="menu-item">
        <span class="menu-icon">üéì</span>
        <span class="menu-text">Rol en el Campus</span>
      </button>
      <button (click)="openCustomizationScreen('skinColor')" class="menu-item">
        <span class="menu-icon">üë§</span>
        <span class="menu-text">Color de Piel</span>
      </button>
      <button (click)="openCustomizationScreen('hairColor')" class="menu-item">
        <span class="menu-icon">üíá</span>
        <span class="menu-text">Color de Cabello</span>
      </button>
      <button (click)="openCustomizationScreen('hairStyle')" class="menu-item">
        <span class="menu-icon">‚úÇÔ∏è</span>
        <span class="menu-text">Estilo de Cabello</span>
      </button>
      <button (click)="openCustomizationScreen('shirtColor')" class="menu-item">
        <span class="menu-icon">üëï</span>
        <span class="menu-text">Color de Camiseta</span>
      </button>
      <button (click)="openCustomizationScreen('shirtType')" class="menu-item">
        <span class="menu-icon">üéΩ</span>
        <span class="menu-text">Tipo de Prenda Superior</span>
      </button>
      <button (click)="openCustomizationScreen('pantsType')" class="menu-item">
        <span class="menu-icon">üëñ</span>
        <span class="menu-text">Tipo de Prenda Inferior</span>
      </button>
      <button (click)="openCustomizationScreen('pantsColor')" class="menu-item">
        <span class="menu-icon">ü©≥</span>
        <span class="menu-text">Color de Parte Inferior</span>
      </button>
      <button (click)="openCustomizationScreen('accessories')" class="menu-item">
        <span class="menu-icon">üëì</span>
        <span class="menu-text">Accesorios</span>
      </button>
    </div>
  </div>

  <!-- Customization Screen -->
  <div class="customization-screen" *ngIf="showCustomizationScreen">
    <div class="customization-header">
      <button (click)="closeCustomizationScreen()" class="btn-back">
        ‚Üê Volver
      </button>
      <h2>
        <span *ngIf="currentCustomizationOption === 'role'">üéì Rol en el Campus</span>
        <span *ngIf="currentCustomizationOption === 'skinColor'">üë§ Color de Piel</span>
        <span *ngIf="currentCustomizationOption === 'hairColor'">üíá Color de Cabello</span>
        <span *ngIf="currentCustomizationOption === 'hairStyle'">‚úÇÔ∏è Estilo de Cabello</span>
        <span *ngIf="currentCustomizationOption === 'shirtColor'">üëï Color de Camiseta</span>
        <span *ngIf="currentCustomizationOption === 'shirtType'">üéΩ Tipo de Prenda Superior</span>
        <span *ngIf="currentCustomizationOption === 'pantsType'">üëñ Tipo de Prenda Inferior</span>
        <span *ngIf="currentCustomizationOption === 'pantsColor'">ü©≥ Color de Parte Inferior</span>
        <span *ngIf="currentCustomizationOption === 'accessories'">üëì Accesorios</span>
      </h2>
      <div></div>
    </div>

    <div class="customization-content">

      <!-- Role Selection -->
      <div class="option-group" *ngIf="currentCustomizationOption === 'role'">
        <label class="option-label">Rol en el Campus</label>
        <div class="button-group role-group">
          <button
            *ngFor="let role of roles"
            [class.active]="avatar.role === role.value"
            (click)="avatar.role = role.value; onOptionChange()"
            class="btn-option btn-role">
            <span class="role-icon">{{ role.icon }}</span>
            <span class="role-name">{{ role.name }}</span>
          </button>
        </div>
      </div>

      <!-- Skin Color -->
      <div class="option-group" *ngIf="currentCustomizationOption === 'skinColor'">
        <label class="option-label">Color de Piel</label>
        <div class="color-grid">
          <button
            *ngFor="let color of skinColors"
            [class.active]="avatar.skinColor === color.value"
            (click)="avatar.skinColor = color.value; onOptionChange()"
            class="color-option"
            [style.background-color]="color.value"
            [attr.aria-label]="color.name">
            <span class="color-name">{{ color.name }}</span>
          </button>
        </div>
      </div>

      <!-- Hair Color -->
      <div class="option-group" *ngIf="currentCustomizationOption === 'hairColor'">
        <label class="option-label">Color de Cabello</label>
        <div class="color-grid">
          <button
            *ngFor="let color of hairColors"
            [class.active]="avatar.hairColor === color.value"
            (click)="avatar.hairColor = color.value; onOptionChange()"
            class="color-option"
            [style.background-color]="color.value"
            [attr.aria-label]="color.name">
            <span class="color-name">{{ color.name }}</span>
          </button>
        </div>
      </div>

      <!-- Hair Style -->
      <div class="option-group" *ngIf="currentCustomizationOption === 'hairStyle'">
        <label class="option-label">Estilo de Cabello</label>
        <div class="button-group">
          <button
            *ngFor="let style of hairStyles"
            [class.active]="avatar.hairStyle === style.value"
            (click)="avatar.hairStyle = style.value; onOptionChange()"
            class="btn-option">
            {{ style.name }}
          </button>
        </div>
      </div>

      <!-- Shirt Color -->
      <div class="option-group" *ngIf="currentCustomizationOption === 'shirtColor'">
        <label class="option-label">Color de Camiseta</label>
        <div class="color-grid color-grid-extended">
          <button
            *ngFor="let color of shirtColors"
            [class.active]="avatar.shirtColor === color.value"
            (click)="avatar.shirtColor = color.value; onOptionChange()"
            class="color-option"
            [style.background-color]="color.value"
            [style.color]="color.value === '#FFFFFF' || color.value === '#F1C40F' ? '#000' : '#FFF'"
            [attr.aria-label]="color.name">
            <span class="color-name">{{ color.name }}</span>
          </button>
        </div>
      </div>

      <!-- Shirt Type -->
      <div class="option-group" *ngIf="currentCustomizationOption === 'shirtType'">
        <label class="option-label">Tipo de Prenda Superior</label>
        <div class="button-group">
          <button
            *ngFor="let type of shirtTypes"
            [class.active]="avatar.shirtType === type.value"
            (click)="avatar.shirtType = type.value; onOptionChange()"
            class="btn-option">
            {{ type.name }}
          </button>
        </div>
      </div>

      <!-- Pants Color -->
      <div class="option-group" *ngIf="currentCustomizationOption === 'pantsColor'">
        <label class="option-label">Color de Parte Inferior</label>
        <div class="color-grid color-grid-extended">
          <button
            *ngFor="let color of pantsColors"
            [class.active]="avatar.pantsColor === color.value"
            (click)="avatar.pantsColor = color.value; onOptionChange()"
            class="color-option"
            [style.background-color]="color.value"
            [style.color]="color.value === '#FFFFFF' ? '#000' : '#FFF'"
            [attr.aria-label]="color.name">
            <span class="color-name">{{ color.name }}</span>
          </button>
        </div>
      </div>

      <!-- Pants Type -->
      <div class="option-group" *ngIf="currentCustomizationOption === 'pantsType'">
        <label class="option-label">Tipo de Prenda Inferior</label>
        <div class="button-group">
          <button
            *ngFor="let type of pantsTypes"
            [class.active]="avatar.pantsType === type.value"
            (click)="avatar.pantsType = type.value; onOptionChange()"
            class="btn-option">
            {{ type.name }}
          </button>
        </div>
      </div>

      <!-- Accessories -->
      <div class="option-group accessories-group" *ngIf="currentCustomizationOption === 'accessories'">
        <label class="option-label">Accesorios (Opcionales)</label>
        <div class="accessories-container">
          <label class="accessory-checkbox">
            <input
              type="checkbox"
              [(ngModel)]="avatar.glasses"
              (change)="onOptionChange()">
            <span class="accessory-label">üëì Gafas</span>
          </label>

          <label class="accessory-checkbox">
            <input
              type="checkbox"
              [(ngModel)]="avatar.headBandana"
              (change)="onOptionChange()">
            <span class="accessory-label">üéÄ Pa√±oleta en el Cabello</span>
          </label>

          <label class="accessory-checkbox">
            <input
              type="checkbox"
              [(ngModel)]="avatar.chestBandana"
              (change)="onOptionChange()">
            <span class="accessory-label">üß£ Pa√±oleta en el Pecho</span>
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="app-footer">
    <p>{{ currentYear }} ¬Æ Te protejo</p>
  </footer>
</div>

<!-- Core Value Popup -->
<div class="popup-overlay" *ngIf="showCoreValuePopup" (click)="closeCoreValuePopup()">
  <div class="popup-content" (click)="$event.stopPropagation()">
    <div class="popup-header">
      <h2>üåü Elige tu Valor Clave</h2>
      <p class="popup-subtitle">Selecciona el compromiso que m√°s te identifica como guardi√°n/a del campus</p>
    </div>

    <div class="core-values-grid">
      <button
        *ngFor="let value of coreValues"
        (click)="selectCoreValue(value.name)"
        class="core-value-card">
        <div class="value-icon">{{ value.icon }}</div>
        <h3 class="value-name">{{ value.name }}</h3>
        <p class="value-description">{{ value.description }}</p>
      </button>
    </div>
  </div>
</div>